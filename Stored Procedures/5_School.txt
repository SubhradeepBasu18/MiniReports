create proc sp_GetAllSchoolNames
as
begin
	select SchoolName from dbo.School
end;

exec sp_GetAllSchoolNames;


create proc sp_GetSchoolDetailsById
	@SchoolID int
as
begin
	select school.SchoolName, site.SiteName, school.Address from dbo.School school
	join dbo.Site site
	on school.SiteID = site.SiteID
end;

exec sp_GetSchoolDetailsById @SchoolID = 2;

ALTER proc [dbo].[sp_InsertSchool]
	@SchoolName varchar(200),
	@SiteID int,
	@Address varchar(300)
as
begin
	insert into School (SchoolName, SiteID, Address)
	values(@SchoolName, @SiteID, @Address)
end;

create or alter proc sp_GetSchoolBySiteID
	@SiteID int
as
begin
	select SchoolID, SchoolName from dbo.School
	where SiteID = @SiteID
end;

exec sp_GetSchoolsBySiteID @SiteID = 1;

ALTER TABLE dbo.School
ALTER COLUMN SiteID INT NULL;


CREATE OR ALTER PROCEDURE dbo.sp_InsertSchool
(
    @SchoolName VARCHAR(200),
	@SiteID int,
    @Address VARCHAR(300)
)
AS
BEGIN
    SET NOCOUNT ON;

    INSERT INTO dbo.School (SchoolName,SiteID, Address)
    VALUES (@SchoolName, @SiteID, @Address);
END

CREATE OR ALTER PROCEDURE dbo.sp_GetAllSchoolNames
AS
BEGIN
    SET NOCOUNT ON;

    SELECT SchoolID, SchoolName
    FROM dbo.School
    WHERE SiteID IS NULL;
END


CREATE OR ALTER PROCEDURE dbo.sp_LinkSchoolToSite
(
    @SchoolID INT,
    @SiteID INT
)
AS
BEGIN
    SET NOCOUNT ON;

    UPDATE dbo.School
    SET SiteID = @SiteID
    WHERE SchoolID = @SchoolID
      AND SiteID IS NULL;
END
